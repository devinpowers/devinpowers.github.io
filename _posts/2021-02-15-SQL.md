---
title: 'Creating a DB in SQLite'

date: 2021-2-15

---

So you want to create a DB using an xlxs file, Python, and SQLite??

[I took a csv file from here!](https://s3.amazonaws.com/tripdata/index.html)

1. Lets First Create the DataBase

We're going to use the columns in the csv file and name the Table, CitiBikes

```python
import sqlite3, csv

conn = sqlite3.connect('citi.db')
cur = conn.cursor()


sql = """
    CREATE TABLE CitiBikes (
        Trip_Duration INTEGER,
        StartTime TEXT,
        StopTime TEXT,
        StartStationID INTEGER,
        StartStationName TEXT,
        StartStationLat DECIMAL,
        StartStationLong DECIMAL,
        EndStationID INTEGER,
        EndStationName TEXT,
        EndStationLat DECIMAL,
        EndStationlog DECIMAL,
        t INTEGAR,
        Usertype TEXT,
        Birthyear TEXT,
        Gender INTEGER
        
        )
    """
    
cur.execute(sql)
print('Database has been created')

conn.commit()
conn.close()
    
```

Now we have sucessfully created a Database named citi.db

Now let import our csv file and the columns into our newly created database.


```python
import sqlite3, csv, pandas

connection  = sqlite3.connect('citi.db')
cursor = connection.cursor()

with open('citibike.csv', 'r') as file:
    no_records = 0
    for row in file:
        cursor.execute("INSERT INTO CitiBikes VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)", row.split(","))
        
        connection.commit()
        no_records +=1
        
connection.close()
print('\n{} Records Transferred'.format(no_records))

print("DONE!")


```


Next time we can do some simple data analysis!

Lets import some libraries

```python
import sqlite3, pandas

import matplotlib.pyplot as plt
```

Lets connect to our Database:
```python
db = sqlite3.connect('citi.db')
```

Lets Execute some Simple Queries SQLite using Pandas

```python

pandas.read_sql_query("SELECT COUNT (*) FROM CitiBikes", db)
```
-> this will return the number of rows from our table CitiBikes

Example of output:
```python
	COUNT (*)
0	1155406

```

Lets SELECT one column from our table:

```python
pandas.read_sql_query("SELECT Trip_Duration FROM CitiBikes", db)
```

Example of potential output:

```python
	Trip_Duration
0	695
1	693
2	2059
3	123
4	1521
...	...
1155401	925
1155402	279
1155403	161
1155404	909
1155405	634

1155406 rows × 1 columns


```

Lets Calculate the average Trip Duration (in seconds)

```python
pandas.read_sql_query("SELECT avg(Trip_Duration) from CitiBikes", db)
```

Example Output:

```python
	AVG(Trip_Duration)
    
0	1372.570279
```

Lets add a helper function to make it easier on us when executing Queries

```python
def Q(sql):
    res = pandas.read_sql_query(sql, db, chunksize = 100_000)
    return next(res)
```

The chunksize is the number of rows we exectute at a time, the next(res) calls for the next chunksize, so 100,000 rows at a time!

```python
res = Q("SELECT * FROM CitiBikes")
```

```python
res
```

Awesome, now heres our output, were working with 15 Columns and 100,000 rows at a time!

```python
	Trip_Duration	StartTime	StopTime	StartStationID	StartStationName	StartStationLat	StartStationLong	EndStationID	EndStationName	EndStationLat	EndStationlog	t	Usertype	Birthyear	Gender
0	695	"2013-06-01 00:00:01"	"2013-06-01 00:11:36"	444	"Broadway & W 24 St"	40.742354	-73.989151	434	"9 Ave & W 18 St"	40.7432	-74.0037	19678	"Subscriber"	1983	1
1	693	"2013-06-01 00:00:08"	"2013-06-01 00:11:41"	444	"Broadway & W 24 St"	40.742354	-73.989151	434	"9 Ave & W 18 St"	40.7432	-74.0037	16649	"Subscriber"	1984	1
2	2059	"2013-06-01 00:00:44"	"2013-06-01 00:35:03"	406	"Hicks St & Montague St"	40.695128	-73.995951	406	"Hicks St & Montague St"	40.6951	-73.996	19599	"Customer"	NULL	0
3	123	"2013-06-01 00:01:04"	"2013-06-01 00:03:07"	475	"E 15 St & Irving Pl"	40.735243	-73.987586	262	"Washington Park"	40.6918	-73.9737	16352	"Subscriber"	1960	1
4	1521	"2013-06-01 00:01:22"	"2013-06-01 00:26:43"	2008	"Little West St & 1 Pl"	40.705693	-74.016777	310	"State St & Smith St"	40.6893	-73.9891	15567	"Subscriber"	1983	1
...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...
99995	312	"2013-06-09 12:12:18"	"2013-06-09 12:17:30"	476	"E 31 St & 3 Ave"	40.743943	-73.979661	509	"9 Ave & W 22 St"	40.7455	-74.002	15509	"Subscriber"	1984	1
99996	1177	"2013-06-09 12:12:24"	"2013-06-09 12:32:01"	445	"E 10 St & Avenue A"	40.727408	-73.981420	477	"W 41 St & 8 Ave"	40.7564	-73.99	20242	"Subscriber"	1964	1
99997	2110	"2013-06-09 12:12:24"	"2013-06-09 12:47:34"	426	"West St & Chambers St"	40.717548	-74.013221	404	"9 Ave & W 14 St"	40.7406	-74.0055	17437	"Subscriber"	1996	1
99998	1058	"2013-06-09 12:12:25"	"2013-06-09 12:30:03"	521	"8 Ave & W 31 St N"	40.750967	-73.994442	428	"E 3 St & 1 Ave"	40.7247	-73.9878	15407	"Subscriber"	1978	1
99999	1870	"2013-06-09 12:12:29"	"2013-06-09 12:43:39"	419	"Carlton Ave & Park Ave"	40.695807	-73.973556	502	"Henry St & Grand St"	40.7142	-73.9813	17989	"Customer"	NULL	0
100000 rows × 15 columns

```


### More Simple SQL Queries

Lets check what Columns are in our Table (CitiBikes)

```python
res.columns
```
Output:

```python
Index(['Trip_Duration', 'StartTime', 'StopTime', 'StartStationID',
       'StartStationName', 'StartStationLat', 'StartStationLong',
       'EndStationID', 'EndStationName', 'EndStationLat', 'EndStationlog', 't',
       'Usertype', 'Birthyear', 'Gender'],
      dtype='object')
```

Ok, lets see what Gender is riding the Bikes
- 0: Unknown Gender
- 1: Male
- 2: Female

```python
res = Q("SELECT Gender, COUNT (*) FROM CitiBikes GROUP BY Gender")
```
```python
res
```

Output:

```python
	Gender	COUNT(*)
0	0	481496
1	1	526984
2	2	146926
```

Lets look at the User Type, which is seperate 